# Generated by Anaconda 36.16.2
# Generated by pykickstart v3.36
#version=F36
# Use graphical install ## comment makes it go away
# graphical
text

# Keyboard layouts
keyboard --vckeymap=pl2 --xlayouts='pl','us'
# System language
lang en_US.UTF-8

#repos
url --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=fedora-$releasever&arch=x86_64
repo --name=updates --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=updates-released-f$releasever&arch=x86_64

%packages
@^minimal-environment

tar
wget

%end

# Run the Setup Agent on first boot
firstboot --enable

# Generated using Blivet version 3.4.3
ignoredisk --only-use=sda
autopart
# Partition clearing information
# clearpart --none --initlabel
clearpart --drives=sda --all

# System timezone
timezone Europe/Warsaw --utc

# Root password
rootpw --iscrypted $y$j9T$2s9fflblDS.cT41qKv.IzW21$D7biVJnGYK2lf/o2gNuYxfjQzc.E8s8Ig/eOnRWtfr5
user --name=rat --password=$y$j9T$k/bcDyoNQSbzacuOY.IRolNV$tV6qUtE8o2NRdOCalhwzCYs2W732qtz8VzEXaw7Spx8 --iscrypted --gecos="rattus norvegicus"


%post

mkdir -p /var/www;cd /var/www
wget https://github.com/pause1/atari/releases/download/0.0.1/build.tar.gz
tar -xf build.tar.gz
mv vol_build/build/* .
rm -rf build.tar.gz vol_build/
sed -i -e 's|http://localhost/atari/server.php|http://atari.pause1.pl/server.php|' main.js
sed -i -e 's|<base href="/">|<base href="./">|' index.html
# instead of opening port 80 since i have no idea why firewalld wont do what its told to do - disabling firewall :)
systemctl stop firewalld

#adding service which will be starting server each time machine starts

echo "[Unit]
Description=atari http server
Documentation=man:SimpleHTTPServer(1)
After=network-online.target
[Service]
Type=simple
Restart=always
WorkingDirectory=/var/www
ExecStart=/usr/bin/python3 -m SimpleHTTPServer 80 &
ExecStop=/bin/kill `/bin/ps aux | /bin/grep SimpleHTTPServer | /bin/grep -v grep | /usr/bin/awk '{ print $2 }'`
[Install]
WantedBy=multi-user.target" >> /etc/systemd/system/atari.service

systemctl enable atari.service

%end

reboot
