# Generated by Anaconda 36.16.2
# Generated by pykickstart v3.36
#version=F36
# Use text mode install
text

# Keyboard layouts
keyboard --vckeymap=us
# System language
lang en_US.UTF-8

# Repo
url --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=fedora-$releasever&arch=x86_64
repo --name=updates --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=updates-released-f$releasever&arch=x86_64

%packages
@^minimal-environment

container-selinux
containerd
criu
libbsd
libnet
libtool-ltdl
runc
tar

moby-engine

%end

# Run the Setup Agent on first boot
firstboot --enable
# Do not configure the X Window System
skipx

# Generated using Blivet version 3.4.3
ignoredisk --only-use=sda
# System bootloader configuration
bootloader --location=mbr --boot-drive=sda
autopart --type=thinp
# Partition clearing information
clearpart --all --initlabel --drives=sda

# System timezone
timezone Europe/Warsaw --utc

#Root password
rootpw --iscrypted $y$j9T$3wp6IfkMqTuwcSchY98z55Gy$uC94g2XhbRWH6xetBI07KLb3sWNE0xgB7t4EG9o7k64
user --groups=wheel --name=fedora --password=$y$j9T$3wp6IfkMqTuwcSchY98z55Gy$uC94g2XhbRWH6xetBI07KLb3sWNE0xgB7t4EG9o7k64 --iscrypted --gecos="fedora"

%post

FILE=/etc/systemd/system/myservice.service

cat > $FILE <<- EOM
[Unit]
Description=My Service
After=docker.service
Requires=docker.service

[Service]
TimeoutStartSec=0
Restart=always
ExecStartPre=-/usr/bin/docker exec %n stop
ExecStartPre=-/usr/bin/docker rm %n
ExecStartPre=/usr/bin/docker pull szymonmusial.eu.org:10000/prodenv:latest
ExecStart=/usr/bin/docker run --rm --name %n \
    -p 80:5000 \
    szymonmusial.eu.org:10000/prodenv:latest

[Install]
WantedBy=default.target
EOM

systemctl enable myservice.service

docker -v
eject
%end

reboot