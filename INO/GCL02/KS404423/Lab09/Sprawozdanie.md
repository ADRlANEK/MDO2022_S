# Zajęcia 09
---

### Instalacja systemu Fedora w VM

Jako środowisko wirtualizacji wybieram VirtualBox. Najpierw tworzę nową maszynę wirtualną w trybie eksperta:

![image-20220612174601637](Sprawozdanie.assets/image-20220612174601637.png)

Ustawiam wielkość pamięci RAM jako 4GB. Następnie tworzę dysk o rozmiarze 15 GB:

![image-20220612175226300](Sprawozdanie.assets/image-20220612175226300.png)

W ustawieniach nowo powstałej maszyny dodaję obraz rozruchowy instalatora w formie ISO pobranego z oficjalnej strony Fedory:

![image-20220612182316247](Sprawozdanie.assets/image-20220612182316247.png)

Następnie uruchamiam maszynę wirtualną:

![image-20220612181703489](Sprawozdanie.assets/image-20220612181703489.png)

Wybieram język na angielski:

![image-20220612181825504](Sprawozdanie.assets/image-20220612181825504.png)

Wybieram dysk, na którym zostanie zainstalowany system:

![image-20220612181846420](Sprawozdanie.assets/image-20220612181846420.png)

Następnie przystępuję do konfiguracji profilu roota, pozwalam na dostęp do niego przez SSH w celu łatwiejszej komunikacji w dalszej części:

![image-20220612181950092](Sprawozdanie.assets/image-20220612181950092.png)

Dalej tworzę konto użytkownika:

![image-20220612182013701](Sprawozdanie.assets/image-20220612182013701.png)

Wybieram instalację jako minimalną z podstawowymi narzędziami:

![image-20220612182616488](Sprawozdanie.assets/image-20220612182616488.png)

Rozpoczyna się proces instalacji:

![image-20220612182632977](Sprawozdanie.assets/image-20220612182632977.png)

### Druga instalacja systemu Fedora w VM jako serwer HTTP dla artefaktu

Aby zaoszczędzić czasu z uwagi na to, że obie maszyny z Fedorą po instalacji są takie same, używam opcji klonowania obrazu dostępnej w VM aby utworzyć drugą instancję.

Następnie maszynie będącej serwerem instaluję oraz konfiguruję Apache httpd jako root:

```bash
$ dnf install -y httpd 
$ dnf group install -y "Web Server"
```

Następnie uruchamiam proces:

```bash
$ systemctl start httpd
$ systemctl enable httpd
```

Na końcu konfiguruję Firewalla aby ten nie blokował requestów:

```bash
$ firewall-cmd --add-service=http --add-service=https --permanent
$ firewall-cmd --reload
```

Dalej instaluję i uruchamiam SSH:

```bash
$ dnf install -y openssh-server
$ systemctl start sshd.service
```

W VirtualBoxie ustawiam sieć na mostkowaną (briged):

![image-20220612195900054](Sprawozdanie.assets/image-20220612195900054.png)

### Umieszczenie artefaktu z projektu na serwerze HTTP

Pobieram z Jenkinsa artefakt:

![image-20220612182509951](Sprawozdanie.assets/image-20220612182509951.png)

Na serwerze tworzę podfolder:

```bash
$ mkdir /var/www/html/simple-tetris
```

Na komputerze hoście łączę się z Powershella do maszyny kopiując plik artefaktu:

```powershell
$ scp C:\Users\kale2\Downloads\simple-tetris-1.3.0-rc.tgz root@192.168.8.106:/var/www/html/simple-tetris/
```

![image-20220612195953038](Sprawozdanie.assets/image-20220612195953038.png)

Na końcu wyciągam plik konfiguracyjny instalatora:

```powershell
$ scp root@192.168.8.106:/root/anaconda-ks.cfg anaconda-ks.cfg
```

![image-20220612200012871](Sprawozdanie.assets/image-20220612200012871.png)

Po połączeniu się z hosta:

![image-20220612200616248](Sprawozdanie.assets/image-20220612200616248.png)



### Konfiguracja instalacji nienadzorowanej

Wygenerowany automatycznie plik `anaconda-ks.cfg` wygląda następująco:

```bash
# Generated by Anaconda 36.16.5
# Generated by pykickstart v3.36
#version=F36
# Use graphical install
graphical

# Keyboard layouts
keyboard --vckeymap=us --xlayouts='us'
# System language
lang en_US.UTF-8

%packages
@^minimal-environment

%end

# Run the Setup Agent on first boot
firstboot --enable

# Generated using Blivet version 3.4.3
ignoredisk --only-use=sda
autopart
# Partition clearing information
clearpart --none --initlabel

# System timezone
timezone Europe/Warsaw --utc

# Root password
rootpw --iscrypted $y$j9T$CeVdtTgXOJ5vrDFZXDLdlS5w$1MymgkYWEb9EAB/NEu.iB6KAKjJnyOz0usO2EwG5qGB
user --groups=wheel --name=konrad --password=$y$j9T$sGCo./zsxHPDngUivgYJZg7c$Ydk4z1Rqzk6Z0SHFh9Db68UgAm.4Ql5gdiRzFnb2oZ4 --iscrypted --gecos="konrad"
```

W powyższym pliku najpierw zmodyfikowano formę instalacji z graficznej na tekstową:

```bash
# Generated by Anaconda 36.16.5
# Generated by pykickstart v3.36
#version=F36
# Use graphical install
text
```

Następnie dodano konfigurację sieciową:

```bash
network --bootproto=dhcp --device=enp0s3 --ipv6=auto --activate
```

Dodano informacje o repozytoriach:

```bash
# Repo
url --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=fedora-$releasever&arch=x86_64
repo --name=updates --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=updates-released-f$releasever&arch=x86_64
```

Dodano jako dependencje `npm`, `wget` oraz `tar`:

```
%packages
@^minimal-environment
npm*
wget
tar
%end
```

Oraz pobrano artefakt:

```bash
# Get artifact
%post
mkdir simple-tetris
wget http://192.168.8.106/simple-tetris/simple-tetris-1.3.0-rc.tgz
tar -xf simple-tetris-1.3.0-rc.tgz -C simple-tetris/
%end
```

Powstały w ten sposób plik prezentuje się następująco:

![image-20220612200441791](Sprawozdanie.assets/image-20220612200441791.png)



Tak utworzony skrypt następnie przekazuję do instalatora Fedory w celu przetestowania, podczas wyboru w menu instalacyjnym wciskam przycisk TAB i podaję następującą komendę:

```bash
inst.ks=https://raw.githubusercontent.com/InzynieriaOprogramowaniaAGH/MDO2022_S/KS404423/INO/GCL02/KS404423/Lab09/anaconda-ks.cfg
```

_**Notka:** Dla uproszczenia na przykładzie prezentacji korzystam z serwisu skracającego linki._

![image-20220612193039181](Sprawozdanie.assets/image-20220612193039181.png)

Instalacja przebiegła prawidłowo:

![image-20220612194315226](Sprawozdanie.assets/image-20220612194315226.png)

W głównym folderze można zobaczyć pobrany i rozpakowany artefakt:

```bash
$ ls
```

![image-20220612200349725](Sprawozdanie.assets/image-20220612200349725.png)
