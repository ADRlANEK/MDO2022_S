pipeline {
    agent any

    stages {
        stage('Clone repo') {
            steps {
                echo 'Cloning repo'
                sh 'ls MDO2022_S || git clone -b PW401793 https://github.com/InzynieriaOprogramowaniaAGH/MDO2022_S.git'
            }
        }
        stage('Build bashtop') {
            steps {
                echo 'Installing bashtop'
                dir("./MDO2022_S/ITE/GCL08/PW401793/Lab03") {
                    sh 'docker build -t bashtop-build .'
                }
            }
        }
        stage('Test bashtop') {
            steps {
                echo 'Testing bashtop'
                dir("./MDO2022_S/ITE/GCL08/PW401793/Lab03") {
                    sh 'docker build . -t bashtop-test -f Dockerfile-test'
                    sh 'docker run -t bashtop-test'
                }
            }
        }
    }
}

