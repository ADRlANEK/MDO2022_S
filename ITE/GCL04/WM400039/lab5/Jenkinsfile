pipeline {
	agent any
	environment {
	npm_creds = credentials('npm-creds')
} 
	stages {
		withEnv(['PATH+NODE=/something=/path/to/node/bin']) {
        		stage('Prepare') {
        		sh "npm install -g yarn"
        		sh "yarn install"
   			 }
		}
		stage('Build_and_publish') {
			steps {
				dir('ITE/GCL04/WM400039/lab5')
					{
						sh 'docker build -f ./build_dockerfile -t app_build:latest .'
						sh 'docker run app_build'
						sh 'yarn install'
						sh 'yarn login $npm_creds'
					}
				} 
			}
		stage('Test') {
			steps {
			        dir('ITE/GCL04/WM400039/lab5')
					{
						sh 'docker build -f/test_dockerfile -t app_test:latest .'
						sh 'docker run test_build'
					}
				}
			}
		}
}


