# Generated by Anaconda 36.16.5
# Generated by pykickstart v3.36
#version=F36
# Use graphical install
text

# Keyboard layouts
keyboard --vckeymap=us --xlayouts='us'
# System language
lang en_US.UTF-8

# Network information
network  --bootproto=dhcp --device=enp0s3 --ipv6=auto --activate
network  --hostname=lab9

url --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=fedora-$releasever&arch=x86_64
repo --name=updates --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=updates-released-f$releasever&arch=x86_64


%packages
@^minimal-environment
@domain-client

%end

# Run the Setup Agent on first boot
firstboot --enable

# Generated using Blivet version 3.4.3
ignoredisk --only-use=sda
# Partition clearing information
clearpart --none --initlabel
# Disk partitioning information
part biosboot --fstype="biosboot" --ondisk=sda --size=2
part pv.71 --fstype="lvmpv" --ondisk=sda --size=15160
part /boot --fstype="xfs" --ondisk=sda --size=667
volgroup fedora_lab9 --pesize=4096 pv.71
logvol / --fstype="xfs" --size=12288 --name=root --vgname=fedora_lab9
logvol swap --fstype="swap" --size=2860 --name=swap --vgname=fedora_lab9

# System timezone
timezone Europe/Warsaw --utc

# Root password
rootpw --iscrypted $y$j9T$TOX8464S4sf36lEv0OFy3qNY$a4dnII8JvfOgYGyhDoc/gF2tXBxj5CXcxnSXOQJdJm6
user --groups=wheel --name=js --password=$y$j9T$Knqdv4h6YK/236XQLR9YxEVH$dw0FRsb1TaXwTPoZ1YTISLYibACaFBFR4Zg0GdMEQ38 --iscrypted --gecos="js"

%post
mkdir jenkins
yum install -y docker
yum install -y wget
systemctl start docker
wget https://raw.githubusercontent.com/bsponge/gomodifytags/main/jenkins/example -O ./jenkins/example
wget https://raw.githubusercontent.com/bsponge/gomodifytags/main/jenkins/expected -O expected
wget https://raw.githubusercontent.com/bsponge/gomodifytags/main/Dockerfile-test-deploy -O Dockerfile-test-deploy

docker build -t deploy-test -f Dockerfile-test-deploy --build-arg image=bsponge/deployment-image:latest
docker run --name test-deployment deploy-test
docker logs test-deployment >> testoutput.log
diff testoutput.log jenkins/expected && touch success
%end
