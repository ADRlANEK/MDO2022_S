# Generated by Anaconda 36.16.5
# Generated by pykickstart v3.36
#version=F36
# Use graphical install
text

# Keyboard layouts
keyboard --vckeymap=pl --xlayouts='pl'
# System language
lang pl_PL.UTF-8

# Network information
network  --bootproto=dhcp --device=enp0s3 --ipv6=auto --activate
network  --hostname=lab9

# Repo
# url --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=fedora-$releasever&arch=x86_64
# repo --name=updates --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=updates-released-f$releasever&arch=x86_64

%packages
@^minimal-environment

%end

# Run the Setup Agent on first boot
firstboot --enable

# Generated using Blivet version 3.4.3
ignoredisk --only-use=sda
autopart
# Partition clearing information
clearpart --none --initlabel

# System timezone
timezone Europe/Warsaw --utc

# Root password
rootpw --iscrypted $y$j9T$oOe/z1olNwb.o9rEqGewMn8e$ZI9D9CWio7qCkmkBD0X.yBkfHwh0GDbr7x8tq8CbBs1
user --groups=wheel --name=js --password=$y$j9T$Ip1cXjLoW8qLorAf8u15ynhx$VLrfV3nI15mXmVGrM5TsnoiqBmjDOxHYwFFaQikvcC2 --iscrypted --gecos="js"

%post
mkdir jenkins
yum install -y docker
systemctl start docker
wget https://raw.githubusercontent.com/bsponge/gomodifytags/main/jenkins/example -O ./jenkins/example
wget https://raw.githubusercontent.com/bsponge/gomodifytags/main/jenkins/expected -O expected
wget https://raw.githubusercontent.com/bsponge/gomodifytags/main/Dockerfile-test-deploy -O Dockerfile-test-deploy

docker build -t deploy-test -f Dockerfile-test-deploy --build-arg image=bsponge/deployment-image:latest
docker run --name test-deployment deploy-test
docker logs test-deployment >> testoutput.log
diff testoutput.log jenkins/expected && touch success
%end
