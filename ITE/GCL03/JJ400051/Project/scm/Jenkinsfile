pipeline {
    agent any
    stages {
        stage('build') {
            steps {
		echo 'Building'
                sh 'docker build -t Builder . -f ITE/GCL03/JJ400051/Project/'
		sh 'docker run --name dock --rm Builder'
		sh 'docker cp dock:irssi/build/src/fe-text/irssi.c'
	    }
        }
        stage('test') {
            steps {
                echo 'Testing'
		sh 'docker build -t Tester . -f ITE/GCL03/JJ400051/Project/'
		sh 'docker run Tester'

            }
        }
	stage('deploy') {
	    steps {
		echo 'Deploying'
		    sh 'docker container create --name Deployer fedora'
		    sh 'docker cd irssi Deployer'
		    sh 'docker container exec Deployer sh -c "apt update"'
		    sh 'docker continer exec Deployer sh -c "apt-get install -y build-essential"'
		    sh 'docker continer exec Deployer sh -c "./irssi"'
		    
	    }
	}
	stage('publish') {
	    steps {
		echo 'Publishing'
		sh 'mkdir Publisher'
		sh 'cp irssi Publisher'
		sh "tar -jcf Version${params.version}.tar.xz Dir"
		archiveArtifacts artifacts: "Version${params.version}.tar.xz"
	    }
	}
    }
}
